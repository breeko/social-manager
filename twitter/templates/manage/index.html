{% extends 'base.html' %}

{% load render_table from django_tables2 %}

{% block javascript %}	
  <script>
    const createOnClick = ({id, table, url}) => {
      $(`#${id}`).click(() => {
        const ids = []
        const t = document.getElementById(table);
        t.querySelectorAll("input[type=checkbox]:checked").forEach(c => {
          const value = c.getAttribute("value")
          value && ids.push(value)
        });
        if (ids.length > 0) {
          $.ajax({
              type: "POST",
              url,
              data: { ids },
              success: () => {
                $("input:checkbox").prop('checked', false);
                location.reload();
              }
          });
        }
          return false;
        });
    };
    $(document).ready(() => {
      createOnClick({id: "delete_follow", table: "follow_table", url: "follow/delete"});
      createOnClick({id: "reschedule_follow", table: "follow_table", url: "follow/reschedule"});
      createOnClick({id: "delete_tweet", table: "tweet_table", url: "tweet/delete"});
      createOnClick({id: "reschedule_tweet", table: "tweet_table", url: "tweet/reschedule"});
    })
  </script>	
{% endblock %}

{% block content %}
  <h3>Tweets</h3>
  
  {% render_table tweets_table %}
  <button id="reschedule_tweet" class="btn">Reschedule</button>
  <button id="delete_tweet" class="btn btn-danger">Delete</button>
  <hr/>
  <h3>Follows</h3>
  {% render_table follows_table %}
  <button id="reschedule_follow" class="btn" name="reschedule">Reschedule</button>
  <button id="delete_follow" class="btn btn-danger">Delete</button>
  <hr/>
{% endblock %}

